<!DOCTYPE html>
<html>
    <head>
        <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js"></script>
        <link rel="stylesheet" href="cstyle.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"/>
    </head>
    <body>
        <h3 id='show'></h3>
        <div class = "main">
        <h3>Our</h3>
        <div class="our" id="our"></div>
        <div class="remote" id="remote"></div>
        </div>
        <div class="sub">
        <form action="client.html">
        <div class="inp1"><input type="text" name="Name" id="name"></div>
        <div class="inp"><input id="peerId" placeholder="Peer id"></div>
        <div class="but"><input type="submit" id="call-peer" placeholder="CaLL"></div>
        </form>
        </div>
        <br>
        <!--<button onclick="share">Share screen</button>-->
        </body>
        <script>
            var total=[];
            var size=0;
        </script>
        <script>
            /*window.addEventListener('load',(event)=>{
                var peer=new Peer()
                var myStream;
                var peerList=[];
                var loc;
                peer.on('open',function(id){
                    document.getElementById("show").innerHTML=id;
                    loc=id;
                    total.push(id);
                    size=size+1;
                    console.log(total[0]);
                })
                peer.on('call',function(call){
                navigator.mediaDevices.getUserMedia({
                    video:true,
                    audio:true
                }).then((stream)=>{
                    myStream=stream
                    addOurVideo(stream)
                    call.answer(stream)
                    call.on('stream',function(remoteStream){
                        if(!peerList.includes(call.peer)){
                            addRemoteVideo(remoteStream)
                            peerList.push(call.peer);
                        }
                    })
                }).catch((err)=>{
                    console.log(err+" can not connect.")
                })
            })
            
            

            document.getElementById("call-peer").addEventListener('click',(e)=>{
               // let remoteId=document.getElementById("peerId").value;
               if(total[0]==loc){
                   remoteId=total[1];
               }
               else
               {
                   remoteId=total[0];
               }
                document.getElementById("show").innerHTML="connecting to "+remoteId;
                callPeer(remoteId);
            })
            function callPeer(id){
                navigator.mediaDevices.getUserMedia({
                    video:true,
                    audio:true
                }).then((stream)=>{
                    myStream=stream
                    addOurVideo(stream)
                    let call=peer.call(id,stream)
                    call.on('stream',function(remoteStream){
                        if(!peerList.includes(call.peer)){
                            addRemoteVideo(remoteStream);
                            peerList.push(call.peer)
                        }
                    })
                }).catch((err)=>{
                    console.log(err+" can not connect.")
                })
            }

            function addRemoteVideo(stream){
                let video=document.createElement("video");
                video.classList.add("video2");
                video.srcObject=stream;
                video.play()
                document.getElementById("remote").append(video)
            }

            function addOurVideo(stream){
                let video=document.createElement("video");
                video.classList.add("video1");
                video.srcObject=stream;
                video.play();
                document.getElementById("our").append(video)
            }
        })*/
        </script>
        <script src="client.js"></script>
</html>